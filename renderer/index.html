<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>WhatsApp Desktop - Bodas</title>
  </head>
  <body>
    <h2>Estado de sesión</h2>
    <div id="estado">Cargando...</div>

    <h2>QR de WhatsApp</h2>
    <img id="qr" src="" width="300" />

    <h2>Log de eventos</h2>
    <pre id="log"></pre>

    <div id="formulario-envio" style="display: none">
      <h2>Enviar mensaje de prueba</h2>
      <input type="text" id="telefono" placeholder="Ej: 34612345678" />
      <button onclick="enviarMensaje()">Enviar mensaje</button>
    </div>

    <script>
      let sesionActiva = false;

      window.electronAPI.onQR((qr) => {
        document.getElementById("qr").src = qr;
      });

      window.electronAPI.onLog((msg) => {
        document.getElementById("log").textContent += msg + "\n";

        if (msg.includes("✅ Sesión conectada")) {
          sesionActiva = true;
          document.getElementById("formulario-envio").style.display = "block";
        }
      });

      window.electronAPI.obtenerEstado().then((estado) => {
        document.getElementById("estado").textContent = estado;
      });

      function enviarMensaje() {
        const telefono = document.getElementById("telefono").value.trim();
        if (!telefono || !sesionActiva) return;
        window.electronAPI.enviarMensaje(telefono);
      }
    </script>
  </body>
</html>
